FROM node:22-alpine

WORKDIR /init

# Copy package files
COPY package.json ./

# Install dependencies needed for init script
RUN npm install

# Copy necessary database files and set drizzle env vars
ENV SCHEMA_LOC='/init/database'
ENV MIGRATION_LOC='/init/database/migrations'

# Copy init script and seed data
COPY dev_env/init-db.mjs ./

# Dummy .env file for npm script compatibility
RUN touch .env

CMD sleep 1 && node init-db.mjs
