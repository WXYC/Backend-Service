FROM node:22-alpine

WORKDIR /init

# Copy slim package file with only required dependencies
COPY dev_env/package.init.json ./package.json

# Install minimal dependencies (postgres, drizzle-kit, drizzle-orm)
RUN npm install --omit=dev

# Set drizzle env vars for migration paths (matches docker-compose volume mounts)
ENV SCHEMA_LOC='/init/database'
ENV MIGRATION_LOC='/init/database/migrations'

# Copy init script
COPY dev_env/init-db.mjs ./

# Dummy .env file for compatibility
RUN touch .env

CMD ["node", "init-db.mjs"]
