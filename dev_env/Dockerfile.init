FROM node:20-alpine

WORKDIR /init

# Copy package files
COPY package.json ./
COPY shared/database/package.json ./shared/database/

# Install dependencies needed for init script
RUN npm install && npm run build --workspace=shared

# Copy entire database package (includes migrations, schema, config)
COPY shared/database/ ./shared/database/

# Copy init script and seed data
COPY dev_env/init-db.js ./
COPY dev_env/install_extensions.sql ./
COPY dev_env/seed_db.sql ./

# Make the script executable
RUN chmod +x init-db.js

CMD ["node", "init-db.js"]
